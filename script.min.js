const n=[{name:"Auto Clicker",i:0n,t:1n,o:100n},{name:"Candy Machine",i:0n,t:5n,o:250n},{name:"Larger Candies",i:1n,t:0n,o:500n},{name:"Grandma",i:2n,t:10n,o:1000n},{name:"Candy Shop",i:3n,t:15n,o:2500n},{name:"Candy Factory",i:5n,t:20n,o:5000n},{name:"Candy Army",i:10n,t:50n,o:50000n},{name:"King Candy",i:15n,t:60n,o:100000n},{name:"Candy Nuke",i:25n,t:100n,o:250000n},{name:"Planet Candy",i:50n,t:500n,o:500000n},{name:"Candy Cosmos",i:100n,t:750n,o:1000000n},{name:"CandyTime Continuum",i:250n,t:1000n,o:2000000n},{name:"Candyverse Portal",i:500n,t:5000n,o:5000000n},{name:"Infinite Candy Theory",i:1000n,t:10000n,o:10000000n},{name:"Unobtainium Candy",i:2500n,t:25000n,o:15000000n}],e=2n**64n-1n,a=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);let i=0n,t=1n,r=0n,o=1n,c=0n,l=0n,d=1n;const p=Array(n.length);p.fill(0n);let s=0,u=0,y=0,f=new Date,m=0;const g=[];let v=0n;const h=new Uint8Array([67,100,67,108,107,49,46,49]);let b,k;function w(n,e){return BigInt.asUintN(64,n+e*n/4n)}function P(){$("#candy-shop").empty();for(let e=0;e<n.length;e++){let i=n[e],t=$("#candy-shop-item-template").contents().clone();t.attr("id","candy-shop-item-"+e);let r=`+${i.i*d} per click, +${i.t*d} per second, ${p[e]} already purchased`;d>=2n&&(r+=`, x${d} applied`),t.attr("title",r),a&&t.css("height","36px"),t.find(".candy-shop-item-name").text(i.name),t.find(".candy-shop-item-price").text(`(${w(i.o,p[e]).toLocaleString()})`),t.on("click",(function(){F(e)})),t.appendTo("#candy-shop")}C()}function C(){for(let e=0;e<n.length;e++){let a=w(n[e].o,p[e]);$("#candy-shop-item-"+e).find(".candy-shop-item-price").css("color",a<=i?"":"gray")}}function I(){let n=$("#candy-shop");n.height($(window).height()-n.offset().top)}function S(){let n=$("#overflow-banner");n.css("visibility",0n==l?"hidden":"visible"),0n==l?n.text("★"):l<1000n?(n.text("★".repeat(Number(l))),n.width()>$(window).width()-20&&n.text("★ x "+l)):n.text("★ x "+l),n.css("margin-top",-n.height())}function B(n){let e=[];for(let a=0n;a<64n;a+=8n)e.push(Number(BigInt.asUintN(8,n>>a)));return new Uint8Array(e)}function A(n){let e=0n;for(let a=0;a<n.length;a++)e+=BigInt(n[a])<<BigInt(8*a);return BigInt.asUintN(64,e)}function x(n){try{let e=n.slice(0,8);for(let n=0;n<8;n++)if(e[n]!=h[n])throw"Invalid save file";let a=n.slice(8),o=a.slice(a.length-16),u=md5.array(a.slice(0,a.length-16));for(let n=0;n<16;n++)if(o[n]!=u[n])throw"Invalid save file";i=A(a.slice(0,8)),t=A(a.slice(8,16)),r=A(a.slice(16,24)),s=0,T(A(a.slice(24,32))),c=A(a.slice(32,40)),l=A(a.slice(40,48)),d=A(a.slice(48,56));for(let n=0;n<(a.length-72)/8&&n<p.length;n++)p[n]=A(a.slice(8*n+56,8*n+64));$("#candy-score").text(i.toLocaleString()),$("#candy-per-second-value").text(r.toLocaleString()),$("#candy-per-click-value").text(t.toLocaleString()),$("#candy-meter").prop("value",s),S(),P()}catch{alert("Modified or corrupt save file detected")}}function U(n){if(0n==n)return;let e=i;i=BigInt.asUintN(64,i+n),$("#candy-score").text(i.toLocaleString()),e>i&&function(n){0n!=n&&(l=BigInt.asUintN(64,l+n),S())}(1n),C()}function T(n){o=n,$("#per-second-multiplier").css("visibility",n<=1n||n==e?"hidden":""),$("#per-second-multiplier-value").text(n.toLocaleString())}function M(){clearInterval(b),clearInterval(k);let n=$("#help-popup-container");n.css("display",""),n.animate({opacity:"1.0"},250)}function N(){let n=BigInt.asUintN(64,100000000n*(o+1n)*(c+1n));return n>=BigInt.asUintN(64,100000000n*o*c)?n:e}function D(){let n=BigInt.asUintN(64,(0n==l?i:e)/100000000n/(c+1n));return n>=o?n:e}function E(){b=setInterval(R,1e3),k=setInterval(_,100);let n=$("#reincarnation-popup-container");n.animate({opacity:"0.0"},250),setTimeout((function(){n.css("display","none")}),300)}function F(e){let a=n[e],o=w(a.o,p[e]);if(o<=i){i-=o,$("#candy-score").text(i.toLocaleString()),0n!=(c=a.t*d)&&(r=BigInt.asUintN(64,r+c),$("#candy-per-second-value").text(r.toLocaleString())),function(n){0n!=n&&(t=BigInt.asUintN(64,t+n),$("#candy-per-click-value").text(t.toLocaleString()))}(a.i*d),p[e]++;let n=$("#candy-shop-item-"+e);n.find(".candy-shop-item-price").text(`(${w(a.o,p[e]).toLocaleString()})`);let l=`+${a.i*d} per click, +${a.t*d} per second, ${p[e]} already purchased`;d>=2n&&(l+=`, x${d} applied`),n.prop("title",l)}else{let n=$("#candy-score");n.clearQueue(),n.animate({opacity:"0.5"},50),n.animate({opacity:"1.0"},50)}var c}function R(){y||o!=e?y&&o!=e&&(y=0,$("body").css("background-color","")):(y=1,$("body").css("background-color","#E5F19E"));let n=$("#total-candy-per-second-endgame");if(n.css("display",y?"":"none"),n.css("visibility",y&&0n==r?"hidden":""),$("#total-candy-per-second").css("display",y?"none":""),new Date-f>=5e3?(g.length=0,$("#clicks-per-second-value").text("0.0")):(g.push(m),m=0,g.length>=2&&$("#clicks-per-second-value").text((g.slice(1).reduce(((n,e)=>n+e))/(g.length-1)).toFixed(1))),!y){let n=o<=1?r:r*o,e=g.length>=2?g.slice(1).reduce(((n,e)=>n+e))/(g.length-1):0,a=u?10n*t:t;$("#total-candy-per-second-value").text((BigInt(Math.round(Number(a)*e))+n).toLocaleString())}}function _(){let n=o<=1n?r:r<=BigInt.asUintN(64,r*o)?BigInt.asUintN(64,r*o):e;if(0n==n)return;let a=n%10n,i=n/10n;0n!=a&&v%(10n/a)==0n&&i++,U(i),v++,10n==v&&(v=0n)}$(window).on("load",(function(){I(),P(),S(),a&&($("#download-desktop-paragraph").css("display","none"),$("#save-data-paragraph").css("display","none")),b=setInterval(R,1e3),k=setInterval(_,100),M()})),$(window).on("resize",(function(){I(),S()})),$("#main-candy").on("click",(function(){if(new Date>new Date(f.getTime()+40)){U(u?10n*t:t),u||(s++,1e3==s?function(){u=1;let n=$("#main-candy"),e=$("#per-click-multiplier");n.attr("src","images/candy-special.png"),e.css("visibility","visible");let a=$("#candy-meter");setTimeout((function(){n.attr("src","images/candy.png"),e.css("visibility","hidden"),a.prop("value",0),u=0,s=0}),5e3);let i=0,t=setInterval((function(){50==i?clearTimeout(t):(a.prop("value",1e3-20*(i+2)),i++)}),100)}():$("#candy-meter").prop("value",s)),f=new Date,m++;let n=$("#main-candy");n.clearQueue(),n.animate({width:Math.random()<=.05?"0px":"162px"},50),n.animate({width:"172px"},50)}})),$("#help-button").on("click",M),$("#help-popup-close-button").on("click",(function(){b=setInterval(R,1e3),k=setInterval(_,100);let n=$("#help-popup-container");n.animate({opacity:"0.0"},250),setTimeout((function(){n.css("display","none")}),300)})),$("#reincarnate-button").on("click",(function(){clearInterval(b),clearInterval(k);let n=N(),a=$("#reincarnation-paragraph"),t=$("#endgame-reincarnation-paragraph"),r=$("#reincarnation-paragraph-result-line"),p=$("#endgame-reincarnation-paragraph-result-line"),s=$("#reincarnate-agree-button");r.css("display","none"),p.css("display","none"),$("#reincarnation-paragraph-divisor").text(BigInt.asUintN(64,100000000n*(c+1n)).toLocaleString()),$("#reincarnation-paragraph-min-cost").text(n.toLocaleString()),i>=n||l>=1?o==e?(a.css("display","none"),t.css("display",""),l>=60n?(s.prop("disabled",0),s.text("Reincarnate (!)"),s.css("color",""),s.css("background-color",""),s.css("border-color",""),p.css("display",""),$("#endgame-reincarnation-paragraph-result").text(BigInt.asUintN(64,d+l/60n).toLocaleString())):(s.prop("disabled",1),s.text("Not Enough Stars"),s.css("color","gray"),s.css("background-color","#f4f4f4"),s.css("border-color","#adb2b5"))):(a.css("display",""),t.css("display","none"),s.prop("disabled",0),s.text("Reincarnate"),s.css("color",""),s.css("background-color",""),s.css("border-color",""),r.css("display",""),$("#reincarnation-paragraph-result").text(D().toLocaleString())):(a.css("display",""),t.css("display","none"),s.prop("disabled",1),s.text("Not Enough Candy"),s.css("color","gray"),s.css("background-color","#f4f4f4"),s.css("border-color","#adb2b5"));let u=$("#reincarnation-popup-container");u.css("display",""),u.animate({opacity:"1.0"},250)})),$("#reincarnation-popup-close-line").on("click",E),$("#reincarnate-agree-button").on("click",(function(){(i>=N()||l>=1)&&(o!=e?(T(D()),c++):(T(1n),c=0n,d+=l/60n),i=0n,t=1n,r=0n,s=0,l=0n,p.fill(0n),$("#candy-score").text(i.toLocaleString()),$("#candy-per-second-value").text(r.toLocaleString()),$("#candy-per-click-value").text(t.toLocaleString()),$("#candy-meter").prop("value",s),S(),P(),E())})),$("#save-button").on("click",(function(){let n=function(){let n=new Uint8Array(56);n.set(B(i)),n.set(B(t),8),n.set(B(r),16),n.set(B(o),24),n.set(B(c),32),n.set(B(l),40),n.set(B(d),48);let e=new Uint8Array(8*p.length);for(let n=0;n<p.length;n++)e.set(B(p[n]),8*n);let a=new Uint8Array(h.length+n.length+e.length+16);a.set(h),a.set(n,h.length),a.set(e,h.length+n.length);let s=new Uint8Array(md5.array(a.slice(8,a.length-16)));return a.set(s,h.length+n.length+e.length),a}();a&&confirm("Are you sure? This will overwrite any existing save data")?localStorage.setItem("save_data",n.join()):download(n,"save_data.dat","application/octet-stream")})),$("#load-button").on("click",(function(){if(a&&confirm("Are you sure? This will overwrite your current progress with the save data"))x(new Uint8Array(localStorage.getItem("save_data").split(",")));else{let n=$("#hidden-uploader");n.on("change",(function(){let e=new FileReader;e.onload=function(){x(new Uint8Array(e.result))},e.readAsArrayBuffer(n.prop("files")[0])})),n.trigger("click")}})),$(window).bind("beforeunload",(function(){return"Are you sure you want to leave? Any progress since your last save will be lost!"}));